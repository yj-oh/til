# í™˜ê²½ì— ë”°ë¼ build ë‹¤ë¥´ê²Œ í•˜ê¸°
- ì´ì „ì— react í™˜ê²½ ë³€ìˆ˜ ì„¤ì •í•˜ëŠ” ê±¸ ì •ë¦¬í–ˆì—ˆë‹¤.
  - `TIL` \[20201105\] : [API Key ìˆ¨ê¸°ê¸°]([20201105]_hide_api_key.md)
  - `TIL` \[20201213\] : [Create React App í™˜ê²½ë³€ìˆ˜]([20201213]_create-react-app_í™˜ê²½ë³€ìˆ˜.md)
- ì¡°ê¸ˆ ë‹¤ë¥¸ ìƒí™©ì´ ìƒê²¼ë‹¤.

---

# ğŸ¤” ìƒí™©
- ì´ 5ê°œì˜ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ê°€ ë– ìˆê³  ê°ê° ë„ë©”ì¸ì„ ê°€ì§„ë‹¤.
  - `Azure dev front`, `Azure dev API`, `Azure production front`,
    `Azure production API`, `AWS`
- CI/CD ì„¤ì •ì´ ë˜ì–´ìˆê³  build í™˜ê²½ì´ Azure ê°œë°œì´ëƒ ìš´ì˜ì´ëƒ AWSëƒì— ë”°ë¼ API í˜¸ì¶œì„ ìœ„í•´
  axiosì— ì„¤ì •í•œ baseURLì´ ë‹¬ë¼ì ¸ì•¼ í•œë‹¤.
- `package.json`ì— `scripts`ëŠ” ì²˜ìŒ CRAë¡œ í”„ë¡œì íŠ¸ ìƒì„±í•  ë•Œ ìë™ìœ¼ë¡œ ì„¤ì •ëœ ê·¸ëŒ€ë¡œ.
    ```json
    {
        "scripts": {
            "start": "react-scripts start",
            "build": "react-scripts build",
            "test": "react-scripts test",
            "eject": "react-scripts eject"
        }
    }
    ```
- í•œì°½ ê°œë°œí•  ë•Œì—ëŠ” AWSë§Œ ë„ì›Œë†¨ê¸° ë•Œë¬¸ì— baseURLì€ ì´ë ‡ê²Œ ì„¤ì •ë˜ì–´ ìˆì—ˆë‹¤.
    ```jsx
    export const Axios = axios.create({
        baseURL: process.env.NODE_ENV === 'production' 
                ? 'https://aws-api.com' : 'http://localhost:8080/',
    });
    ```
- ë¡œì»¬ì€ `development build`, ì„œë²„ ì˜¬ë¼ê°€ë©´ `production build`
- ì„œë²„ê°€ ì—¬ëŸ¬ ëŒ€ê°€ ë˜ë‹ˆ ìœ„ì˜ ì„¤ì •ë§Œìœ¼ë¡œ ì»¤ë²„í•  ìˆ˜ê°€ ì—†ê²Œ ë¨.

# ğŸ’­ ë°©ë²• ê³ ë¯¼
- API urlì„ ì •ì˜í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ê°ê°ì˜ íŒŒì¼ë§ˆë‹¤ ì„ ì–¸í•´ë†“ê³  
  í™˜ê²½ì— ë”°ë¼ ì§€ì •í•œ í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ì„ ì´ìš©í•´ ë¹Œë“œí•˜ë„ë¡ í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?
- `TIL` \[20201213\] : [Create React App í™˜ê²½ë³€ìˆ˜]([20201213]_create-react-app_í™˜ê²½ë³€ìˆ˜.md) ì˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì™”ë‹¤.

| ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íŒŒì¼ëª…                                                         | ì„¤ëª…                                                                     |
|----------------------------------------------------------------------|------------------------------------------------------------------------|
| `.env`                                                               | Default                                                                |
| `.env.local`                                                         | Local overrides. This file is loaded for all environments except test. |
| `.env.development`, `.env.test`, `.env.production`                   | Environment-specific settings.                                         |
| `.env.development.local`, `.env.test.local`, `.env.production.local` | Local overrides of environment-specific settings.                      |

# ğŸ’¡ í•´ê²°

### 1. root ë””ë ‰í„°ë¦¬ì— `.env`, `.env.local`, `.env.production` íŒŒì¼ ìƒì„±
- `.env` : Azure ê°œë°œ API url
- `.env.local` : AWS ê°œë°œ API url
- `.env.production` : Azure ìš´ì˜ API url

### 2. ë‚´ë¶€ì— url ì •ì˜
```text
REACT_APP_BASE_URL = url
```

### 3. baseURL ì„¤ì • ì‹œ í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©
```jsx
export const Axios = axios.create({
    baseURL: process.env.REACT_APP_BASE_URL,
});
```

### 4. package `env-cmd` ì¶”ê°€
- A simple node program for executing commands using an environment from an env file.
```text
npm install env-cmd 

or 

yarn add env-cmd
```

### 5. package.jsonì˜ scriptsë¥¼ ìˆ˜ì •
#### * ì°¸ê³  : [ê° íŒŒì¼ ë³„ ìš°ì„  ìˆœìœ„]([20201213]_create-react-app_í™˜ê²½ë³€ìˆ˜.md)
| ëª…ë ¹ì–´           | íŒŒì¼ ìš°ì„  ìˆœìœ„                                                                |
|---------------|-------------------------------------------------------------------------|
| npm start     | `.env.development.local` > `.env.local` > `.env.development` > `.env`   |
| npm run build | `.env.production.local` > `.env.local` > `.env.production` > `.env`     |
| npm test      | `.env.test.local` > `.env.test` > `.env` (note `.env.local` is missing) |

```json
{
    "scripts": {
        "start": "react-scripts start",
        "build": "env-cmd -f .env react-scripts build",
        "build:prod": "env-cmd -f .env.production react-scripts build",
        "test": "react-scripts test",
        "eject": "react-scripts eject"
    }
}
```
- yarn start : `.env.local` (AWS ê°œë°œ API url)
- yarn build : `.env` (Azure ê°œë°œ API url)
- yarn build:prod : `.env.production` (Azure ìš´ì˜ API url)
