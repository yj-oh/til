## ğŸ’â€â™€ï¸ ì´ì „ í¸ : [git checkout -b <new_branch> \[\<start point\>\]]([20201109]_connot_lock_ref.md)
# test repository 
- ëª¨ë“  í…ŒìŠ¤íŠ¸ëŠ” `yj-oh/test`ì— ìˆëŠ” ì½”ë“œë¡œ ì‹¤ì‹œí•œë‹¤.
- cloneì„ ë–´ë‹¤. 
- ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ì™€ ê°™ì€ ìƒíƒœë‹¤.

![sourcetree](.%5B20201111%5D_cannot_lock_ref2/fb6a0d8b.png)

## ğŸ’» test
#### ğŸ‘‰ test í”„ë¡œì íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ì€ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤.
    - .git í´ë” ë‚´ë¶€ì— refs í´ë”ê°€ ìˆë‹¤.
        - refs í´ë” ë‚´ë¶€ì— heads, remotes, tags í´ë”ê°€ ìˆë‹¤.

![](.%5B20201111%5D_cannot_lock_ref2/4efe44c3.png)

#### ğŸ‘‰ í¼ì¹˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.
```text
|-- apple1.txt
|-- apple2.txt
|-- dev1.txt
|-- dev2.txt
|-- page1.html
|-- page2.html
|-- page3.html
|-- README.md
|-- .git
|   |-- hooks
|   |   `-- {...}
|   |-- info
|   |   `-- exclude
|   |-- logs
|   |   |-- refs
|   |   |   `-- {...}
|   |   `-- HEAD
|   |-- objects
|   |   `-- {...}
|   |-- ğŸ“‚ refs
|   |   |-- ğŸ“‚ heads
|   |   |   |-- ğŸ“„ apple
|   |   |   |-- ğŸ“„ dev
|   |   |   `-- ğŸ“„ master
|   |   |-- ğŸ“‚ remotes
|   |   |   `-- ğŸ“‚ origin
|   |   |       `-- ğŸ“„ HEAD
|   |   `-- ğŸ“‚ tags
|   `-- {...}
`-- build.gradle
```
- (Emojiê°€ ë¶™ì€ ì•„ì´ë“¤ë§Œ ì‚´í´ë³¼ ê²ƒì´ë‹¤.)

#### ğŸ‘‰ ì¤‘ì ì ìœ¼ë¡œ ë³¼ refs í´ë” ë‚´ë¶€ íŒŒì¼ë“¤ì˜ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.
### ğŸ“„ .git/refs/heads/apple
- apple2 ì˜ SHA-1
```text
6e4efece9784bec660135a4a26da209e582889da
```

### ğŸ“„ .git/refs/heads/dev
- dev2 ì˜ SHA-1
```text
7deb4132883b734411ed9aec0331531bf34eae64
```

### ğŸ“„ .git/refs/heads/master
- page3 ì˜ SHA-1
```text
af31fc5a623d621c8d75f11624dd774495320a6e
```

### ğŸ“„ .git/refs/remotes/origin/HEAD
```text
ref: refs/remotes/origin/master
```

---

## default ìƒíƒœë¥¼ íŒŒì•…í–ˆìœ¼ë‹ˆ ë§ˆìŒê» ì£¼ë¬¼ì£¼ë¬¼ í•´ë³´ì.
- ì„¤ëª…ì€ `git log`ë¡œ ë˜ì–´ ìˆì§€ë§Œ, ì‹¬í”Œí•˜ê²Œ íŒŒì•…í•˜ê¸° ìœ„í•´ ì‹¤ì œ ì‚¬ìš©í•œ ëª…ë ¹ì–´ëŠ” `log --pretty=oneline`ì„ì„ ë¯¸ë¦¬ ë°íŒë‹¤.

```git
git log {SHA-1}
```
- ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ í•´ë‹¹ SHA-1 ê°’ì„ ê°€ì§€ëŠ” ì»¤ë°‹ê³¼ ê·¸ ì´ì „ì˜ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- masterì˜ ë§ˆì§€ë§‰ ì»¤ë°‹ì„ ê¸°ì¤€ìœ¼ë¡œ íˆìŠ¤í† ë¦¬ë¥¼ ì¡°íšŒí•´ë³´ì.
![](.%5B20201111%5D_cannot_lock_ref2/cdc1d6d7.png)
- í•˜ì§€ë§Œ ë§¤ë²ˆ ì´ëŸ° ì‹ìœ¼ë¡œ, ì™¸ìš°ê¸° ì–´ë ¤ìš´ SHA-1 ê°’ì„ ì´ìš©í•´ ë¡œê·¸ë¥¼ ì¡°íšŒí•  ìˆ˜ëŠ” ì—†ëŠ” ì¼ì´ë‹¤.
- ì‰¬ìš´ ì´ë¦„ìœ¼ë¡œ ëœ í¬ì¸í„°ê°€ ìˆìœ¼ë©´ ì¢‹ê² ë‹¤.
- ê·¸ í¬ì¸í„°ëŠ” ì´ë¯¸ ì¡´ì¬í•œë‹¤.
- ëª…ë ¹ì–´ `git log af31` ëŒ€ì‹  `git log master`ë¥¼ ì‚¬ìš©í•´ë³´ì.
![](.%5B20201111%5D_cannot_lock_ref2/4998ed2d.png)
- ë™ì¼í•œ íˆìŠ¤í† ë¦¬ê°€ ë¬¸ì œ ì—†ì´ ì¡°íšŒëœë‹¤.
- ì–´ë–»ê²Œ ì´ê²Œ ê°€ëŠ¥í• ê¹Œ? ë¬´ì—‡ì´ í¬ì¸í„°ì˜ ì—­í• ì„ í•˜ê³  ìˆì„ê¹Œ?

```
echo "181fe5ed30a2bd0c5ecc33df530f3efc95daa188" > .git/refs/heads/master
```
- `181fe5ed30a2bd0c5ecc33df530f3efc95daa188`ë¼ëŠ” ë‚´ìš©ì„ ê°€ì§„ `.git/refs/heads/master`ë¥¼ ìƒì„±í•œë‹¤.
- ì´ë¯¸ íŒŒì¼ì´ ì¡´ì¬í•˜ë©´ ë‚´ìš©ì„ êµì²´í•œë‹¤.
- ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê³  cat ëª…ë ¹ì–´ë¡œ í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì„ í™•ì¸í•´ë³´ë©´, ì•„ë˜ì™€ ê°™ë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/c99650fc.png)
- ë‚´ìš©ì´ `af31...`ì—ì„œ `181f...`ë¡œ ìˆ˜ì •ë˜ì—ˆë‹¤.
- `git log master`ë¥¼ í™•ì¸í•˜ë©´?
- `master`ê°€ page2 ì»¤ë°‹ìœ¼ë¡œ ì´ë™í–ˆë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/acc1a4a0.png)

### .git/refs/heads/masterê°€ ê°€ì§€ê³  ìˆëŠ” SHA-1 ê°’ì´ í¬ì¸í„° ì—­í• ì„ í•˜ê³  ìˆë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤.
### í•˜ì§€ë§Œ ìˆ¨ê²¨ì ¸ ìˆëŠ” Refsì˜ íŒŒì¼ì„ ì§ì ‘ ê³ ì¹˜ëŠ” ê²ƒì€ ì ì ˆí•˜ì§€ ì•Šë‹¤. ì•ˆì „í•˜ê²Œ ìˆ˜ì •í•˜ëŠ” ë°©ë²•ì€?
### ì´ë•Œ `git update-ref` ëª…ë ¹ì–´ê°€ ë“±ì¥í•œë‹¤.
- `181f` ì»¤ë°‹ì˜ ì´ì „ ì»¤ë°‹ì¸ `9006`ì„ ê°€ë¦¬ì¼œë³´ì.
```git
git update-ref refs/heads/master 9006
```
![](.%5B20201111%5D_cannot_lock_ref2/bf2514fe.png)
- `echo` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ì„œ ìˆ¨ê²¨ì ¸ìˆëŠ” íŒŒì¼ì„ ì§ì ‘ ìˆ˜ì •í•˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ ë™ì¼í•œ ì´í™íŠ¸ë¥¼ ëƒˆë‹¤.
### update-ref ëª…ë ¹ì–´ëŠ” ì´ëŸ° ì´ìœ  ë•Œë¬¸ì— ì¡´ì¬í•œë‹¤.

## `git branch {branch_name}`ì´ ë“±ì¥í•œë‹¤.
- í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ gitì€ ë‚´ë¶€ì ìœ¼ë¡œ update-ref ëª…ë ¹ì„ ì‹¤í–‰í•œë‹¤.
- ì…ë ¥ë°›ì€ ë¸Œëœì¹˜ ì´ë¦„ê³¼ í˜„ ë¸Œëœì¹˜ì˜ ë§ˆì§€ë§‰ ì»¤ë°‹ì˜ SHA-1 ê°’ì„ ê°€ì ¸ë‹¤ update-ref ëª…ë ¹ì„ ì‹¤í–‰í•œë‹¤.
- ì´ ë§ì¸ ì¦‰ìŠ¨, \
![](.%5B20201111%5D_cannot_lock_ref2/bf2514fe.png)
- ì´ ìƒíƒœì—ì„œ `git branch master2` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ 
- gitì´ ë‚´ë¶€ì ìœ¼ë¡œ `git update-ref refs/heads/master2 9006` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œë‹¤ëŠ” ë§ì´ë‹¤.
- ì§„ì§œ ê·¸ëŸ°ì§€ í™•ì¸í•´ë³´ì.
- ìš°ì„  `git branch master2`ë¥¼ ì‹¤í–‰í•œë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/b59364ba.png)
- `master2` íŒŒì¼ì´ ìƒˆë¡œ ìƒì„±ë˜ì—ˆë‹¤.
- ë‚´ë¶€ë¥¼ ì‚´í´ë³´ë©´ `9006...` ê°’ì´ ë“¤ì–´ìˆì„ ê²ƒì´ë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/f1f48c23.png)
- ë¹™ê³ 
- ë¡œê·¸ë¥¼ ì°ì–´ë³´ì.\
![](.%5B20201111%5D_cannot_lock_ref2/bf2514fe.png)
- ì´ ìƒíƒœì—ì„œ `master2`ê°€ ì¶”ê°€ë˜ì—ˆì„ ê²ƒì´ë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/dd9c73e7.png)
- ë¹™ê³ 
- ë‹¤ì‹œ ì´ˆê¸°í™”í–ˆë‹¤.

## ë˜ë‹¤ì‹œ ë“±ì¥í•œë‹¤ `git checkout -b {branch_name}` (-b ì˜µì…˜ì´ ë¶™ì—ˆë‹¤.)
- ì´ ëª…ë ¹ì–´ëŠ” ì•„ë˜ì™€ ê°™ì´ ë™ì‘í•œë‹¤. 
    - git branch {branch_name} + git checkout {branch_name}
    - ê·¸ë¦¬ê³  ìœ„ì˜ ëª…ë ¹ì–´ëŠ” ë˜ë‹¤ì‹œ ì•„ë˜ì™€ ê°™ì´ ë™ì‘í•œë‹¤.
        - git update-ref refs/heads/{branch_name} {ë§ˆì§€ë§‰ ì»¤ë°‹ì˜ SHA-1} + git checkout {branch_name}

- ê·¸ëŸ¬ë¯€ë¡œ
- `master` ë¸Œëœì¹˜ì˜ ë§ˆì§€ë§‰ ì»¤ë°‹ `af31`ì—ì„œ
- `git checkout -b new`ë¥¼ ì‹¤í–‰í•˜ë©´
```git
git update-ref refs/heads/new af31
git checkout new
```
- ê°€ ì‹¤í–‰ë  ê²ƒì´ë‹¤.
- .git/refs/heads ì•„ë˜ì— ìƒˆë¡­ê²Œ new íŒŒì¼ ìƒì„±ë˜ê³ , ë‚´ë¶€ì—ëŠ” `af31...` ê°’ì´ ì €ì¥ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/2ee82c02.png)
- ã„´ `new` ë¸Œëœì¹˜ê°€ ìƒì„±ë˜ì—ˆë‹¤. \
![](.%5B20201111%5D_cannot_lock_ref2/da9f4eb7.png)
- ã„´ .git/refs/heads ì•„ë˜ì— ìƒˆë¡­ê²Œ new íŒŒì¼ ìƒì„±ë˜ì—ˆë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/3f9576f7.png)
- ã„´ new íŒŒì¼ ë‚´ë¶€ì— `af31...` ê°’ì´ ì €ì¥ë˜ì—ˆë‹¤.
- ë¹™ê³ 
- ë‹¤ì‹œ ì´ˆê¸°í™”í–ˆë‹¤.

## ê·¸ëŸ¼ `git checkout -b new`ê°€ ì•„ë‹ˆë¼ `git checkout -b new origin/apple/dev`ë¥¼ ì‹¤í–‰í•˜ë©´?
- git update-ref refs/heads/new af31
- git checkout new
- ê·¼ë° start_pointê°€ `origin/apple/dev`ì´ë¯€ë¡œ
![](.%5B20201111%5D_cannot_lock_ref2/d6bb397b.png)
- ã„´ ì´ ìƒíƒœì—ì„œ
![](.%5B20201111%5D_cannot_lock_ref2/8518abbb.png)
- ã„´ ì´ë ‡ê²Œ ë˜ê³ 
- .git/refs/heads ì•„ë˜ì— ìƒˆë¡­ê²Œ new íŒŒì¼ ìƒì„±ë˜ê³ 
- new íŒŒì¼ ë‚´ë¶€ì— `6e4e...` ê°’ì´ ì €ì¥ë  ê²ƒì´ë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/fa9d3d20.png)
- ã„´ `6e4e` ì»¤ë°‹ì„ ë² ì´ìŠ¤ë¡œ ì‚¼ì€ `new` ë¸Œëœì¹˜ê°€ ìƒì„±ë˜ì—ˆë‹¤. \
![](.%5B20201111%5D_cannot_lock_ref2/e9b3ff4f.png)
- ã„´ .git/refs/heads ì•„ë˜ì— ìƒˆë¡­ê²Œ new íŒŒì¼ ìƒì„±ë˜ì—ˆë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/4632095b.png)
- ã„´ new íŒŒì¼ ë‚´ë¶€ì— `6e4e...` ê°’ì´ ì €ì¥ë˜ì—ˆë‹¤.
- ë¹™ê³ 
- ë‹¤ì‹œ ì´ˆê¸°í™”í–ˆë‹¤.

## ê·¸ëŸ¼ git checkout -b apple/dev origin/apple/dev ëŠ”?
- git update-ref refs/heads/apple/dev 6e4e
- git checkout apple/dev
1. `6e4e` ì»¤ë°‹ì„ ë² ì´ìŠ¤ë¡œ ì‚¼ì€ `apple/dev` ë¸Œëœì¹˜ê°€ ìƒì„±ë  ê²ƒì´ë‹¤.
2. .git/refs/heads ì•„ë˜ì— ìƒˆë¡­ê²Œ apple/dev íŒŒì¼ì´ ìƒì„±ë  ê²ƒì´ë‹¤.
3. apple/dev íŒŒì¼ ë‚´ë¶€ì— `6e4e...` ê°’ì´ ì €ì¥ë  ê²ƒì´ë‹¤.

### But
- 1ë²ˆì˜ `apple/dev` ë¸Œëœì¹˜ê°€ ìƒì„±ë˜ì§€ ëª»í•œë‹¤.
- ì´í›„ëŠ” ë‹¹ì—°íˆ ì‹¤í–‰ë˜ì§€ ì•Šê² ì§€?

### git checkout -b apple/dev origin/apple/dev ë§ê³  ì§ì ‘ í•˜ë‚˜í•˜ë‚˜ ëª…ë ¹ì–´ë¥¼ ë‚ ë ¤ë³´ì.
### 1. git update-ref refs/heads/apple/dev 6e4e (ì‹¤íŒ¨)
```text
fatal: update_ref failed for ref 'refs/heads/apple/dev': 
cannot lock ref 'refs/heads/apple/dev': 'refs/heads/apple' exists; 
cannot create 'refs/heads/apple/dev'
```
![](.%5B20201111%5D_cannot_lock_ref2/7c55101a.png)
- ã„´ ì´ëŸ° ìƒíƒœë‹¤. appleì€ íŒŒì¼ì´ê¸° ë•Œë¬¸ì— appleì˜ í•˜ìœ„ devë¥¼ ê°€ì§ˆ ìˆ˜ ì—†ë‹¤.
- `apple/dev` ë¸Œëœì¹˜ëŠ” ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.
- `git stash`ë¡œ í™•ì¸í•´ë„ ì•„ë¬´ëŸ° ë³€ê²½ì‚¬í•­ì´ ì—†ê³ , ì´ˆê¸°í™” ìƒíƒœë‹¤.
- ì—¬ê¸°ì„œ ë©ˆì¶”ì§€ ì•Šê³  ìƒˆ íŒŒì¼ì´ ìƒì„±ë˜ëŠ” ê±¸ ë³´ë©´, 1ë²ˆ ëª…ë ¹ì–´ì˜ ì„±ê³µ/ì‹¤íŒ¨ì™€ ìƒê´€ì—†ì´ 2ë²ˆ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” ë“¯.
- 2ë²ˆì„ ì‹¤í–‰í•´ë³´ê² ë‹¤.

### 2. git checkout apple/dev
![](.%5B20201111%5D_cannot_lock_ref2/562989a4.png)
- ë¬¸ì œëŠ” ì—¬ê¸°ì„œ ë°œìƒí•œë‹¤.
- apple/dev ë¸Œëœì¹˜ëŠ” 1ë²ˆì—ì„œ ì‹¤íŒ¨í•´ì„œ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— checkoutì„ í–ˆì„ ë•Œ ê°ˆ ìˆ˜ ì—†ë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/199f3b8e.png)
- ã„´ ì¼ë°˜ì ì¸ ê²½ìš°ë¼ë©´ ìœ„ì™€ ê°™ì€ errorê°€ ëœ¨ë©´ì„œ ì•„ë¬´ëŸ° ë³€í™”ê°€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.
- ê·¼ë° ë³€í™”ê°€ ì¼ì–´ë‚¬ë‹¤. ìƒˆ íŒŒì¼ì´ ìƒê²¼ë‹¤. ì™œ?
- ë‹¤ì‹œ ì´ˆê¸°í™” ìƒíƒœì—ì„œ 1ë²ˆ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê³  ëª¨ë“  ìƒíƒœì™€ íŒŒì¼ ë‚´ë¶€ì˜ ê°’ì„ í™•ì¸í–ˆì§€ë§Œ ë°”ë€ŒëŠ” ê²ƒì´ ì—†ì—ˆë‹¤.
### ê·¸ë ‡ë‹¤ë©´ ì—´ì‡ ëŠ” 2ë²ˆ ëª…ë ¹ì–´ì¸ `git checkout apple/dev`ì— ë‹¬ë ¤ìˆë‹¤.
- ìœ„ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´
- `git checkout -b apple/dev origin/apple/dev` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œì™€ ê°™ì€ ì—ëŸ¬ë¥¼ ë§Œë‚  ìˆ˜ ìˆë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/e5b071f8.png)
![](.%5B20201111%5D_cannot_lock_ref2/3cd3b3ee.png)
- ìƒˆ íŒŒì¼ë„ ë˜‘ê°™ì´ ìƒê¸°ê³ .
- `git checkout apple/dev`ë¥¼ ì‹¤í–‰ì‹œì¼°ì„ ë•Œ .git íŒŒì¼ì—ì„œ ë³€ê²½ë˜ëŠ” íŒŒì¼ì€ `index` ë°–ì— ì—†ë‹¤.
- ê·¸ë¦¬ê³  `index` íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¤ë ¤ê³  í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²½ê³ ì°½ì´ ëœ¬ë‹¤.
![](.%5B20201111%5D_cannot_lock_ref2/65ef313b.png)
- ë‹¤ìŒ ì‹œê°„ì—ëŠ” `index`ë¥¼ íŒŒí—¤ì³ë³´ê² ë‹¤.
