# CORSì— ëŒ€í•œ ì´í•´
- Cross-Origin Resource Sharing
- êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ 

## ğŸ¤“ ê²°ë¡ 
- Originì´ ë‹¤ë¥¸ ìš”ì²­ì„ ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ì°¨ë‹¨
- í•˜ì§€ë§Œ ë‹¤ë¥¸ Originìœ¼ë¡œë¶€í„°ì˜ ë¦¬ì†ŒìŠ¤ ê³µìœ ê°€ í•„ìš”í•œ ê²½ìš°ê°€ ë§ë‹¤.
- ê·¸ë˜ì„œ CORSê°€ ì¡´ì¬.
- CORS í‘œì¤€ì„ ì§€í‚¨ ìš”ì²­ìœ¼ë¡œ ë‹¤ë¥¸ Originì´ë”ë¼ë„ ìš”ì²­/ì‘ë‹µì´ ê°€ëŠ¥í† ë¡ í•¨.

---

# ğŸ‘‰ Origin
```text
URI = scheme:[//authority]path[?query][#fragment]
```
![url](.%5B20210221%5D_cors_images/6c43cbd3.png)
- `Protocol` + `Hostname` (+ `Port`)

# ğŸ‘‰ Same-origin policy
```text
The same-origin policy is a critical security mechanism that restricts 
how a document or script loaded from one origin can interact with a resource 
from another origin. It helps isolate potentially malicious documents, 
reducing possible attack vectors.
```
* https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy

- `http://store.company.com/dir/page.html`
  
| URL	                                            | Outcome     | Reason                                         |
|-------------------------------------------------|-------------|------------------------------------------------|
| http://store.company.com/dir2/other.html        | Same origin | Only the path differs                          |
| http://store.company.com/dir/inner/another.html | Same origin | Only the path differs                          |
| https://store.company.com/page.html             | Failure     | Different protocol                             |
| http://store.company.com:81/dir/page.html       | Failure     | Different port (http:// is port 80 by default) |
| http://news.company.com/dir/page.html           | Failure     | Different host                                 |

# ğŸ‘‰ ë°©ë²• 3ê°€ì§€

## 1. Preflight Request
- ë³¸ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ ìš”ì²­ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•œ ì˜ˆë¹„ ìš”ì²­

![Preflight Request](.%5B20210221%5D_cors_images/4a1fa36c.png)

| Key                            | Description                                                          |
|--------------------------------|----------------------------------------------------------------------|
| Origin                         | Indicates where a fetch originates from.                             |
| Access-Control-Request-Method  | ë³¸ ìš”ì²­ì´ ì´ë£¨ì–´ì§ˆ ë•Œ ì–´ë–¤ HTTP methodê°€ ì‚¬ìš©ë ì§€ ì„œë²„ì— ì•Œë ¤ì£¼ê¸° ìœ„í•¨                        |
| Access-Control-Request-Headers | ë³¸ ìš”ì²­ì´ ì´ë£¨ì–´ì§ˆ ë•Œ ì–´ë–¤ HTTP headersê°€ ì‚¬ìš©ë ì§€ ì„œë²„ì— ì•Œë ¤ì£¼ê¸° ìœ„í•¨                       |
| Access-Control-Allow-Origin    | Indicates whether the response can be shared.                        |
| Access-Control-Allow-Methods   | resourceì— ì—‘ì„¸ìŠ¤í•  ë•Œ í—ˆìš©ë˜ëŠ” ë©”ì„œë“œ                                            |
| Access-Control-Allow-Headers   | ë³¸ ìš”ì²­ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” HTTP headers                                          |
| Access-Control-Max-Age         | Indicates how long the results of a preflight request can be cached. |

- response 200ê³¼ CORS ì •ì±… ì í•©ì„± ì—¬ë¶€ëŠ” ê´€ê³„ê°€ ì—†ë‹¤.
  - responseë¥¼ ë°›ì€ í›„ ìœ„ë°˜ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê¸° ë•Œë¬¸ì— 200ì´ë”ë¼ë„ ì •ì±… ìœ„ë°˜ìœ¼ë¡œ ì—ëŸ¬ ì²˜ë¦¬ë  ìˆ˜ ìˆìŒ.
  - ê·¸ëŸ¬ë‹ˆ Preflight ìš”ì²­ì— ì¤‘ìš”í•œ ê²ƒì€ 
    **ìœ íš¨í•œ `Access-Control-Allow-Origin`ê°€ response headerì— ë‚´ë ¤ì˜¤ëŠëƒ** ë‹¤.

## 2. Simple Request
- Preflight ìš”ì²­ì„ ë³´ë‚´ì§€ ì•Šê³ , ë³¸ ìš”ì²­ì„ í†µí•´ CORS ì •ì±… ì í•©ì„± ì—¬ë¶€ë¥¼ íŒë‹¨.

![Simple Request](.%5B20210221%5D_cors_images/a75f5b05.png)

#### ë‹¤ìŒì„ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” ìš”ì²­
- ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ methods
  - GET
  - HEAD
  - POST
- Headers
  - Accept
  - Accept-Language
  - Content-Language
  - Content-Type
    - application/x-www-form-urlencoded
    - multipart/form-data
    - text/plain
  - DPR
  - Downlink
  - Save-Data
  - Viewport-Width
  - Width

## 3. Credentialed Request
- ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì €ëŠ” XMLHttpRequest or Fetch í˜¸ì¶œì— ì¿ í‚¤ ì •ë³´, ìê²© ì¦ëª…ì„ ë³´ë‚´ì§€ ì•ŠìŒ.
- íŠ¹ì • í”Œë˜ê·¸ë¥¼ ì„¤ì •í•˜ì—¬ ìê²© ì¦ëª…ì„ ë³´ë‚¼ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ìš”ì²­ ë°©ì‹.

![https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#requests_with_credentials](.%5B20210221%5D_cors_images/dc84e8f3.png)

- ì‘ë‹µ í—¤ë”ì— ë°˜ë“œì‹œ `Access-Control-Allow-Credentials: true`ê°€ ìˆì–´ì•¼ í•¨.
  - [MDN Web Docs - Access-Control-Allow-Credentials](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)
- ê·¸ë¦¬ê³  Access-Control-Allow-Origin header ì— "*" ì™€ì¼ë“œì¹´ë“œ ë§ê³  ë°˜ë“œì‹œ ê°’ ì§€ì •í•´ì•¼ í•¨.
```text
ìê²©ì¦ëª… ìš”ì²­ ë° ì™€ì¼ë“œì¹´ë“œ(Credentialed requests and wildcards)

credentialed request ì— ì‘ë‹µí•  ë•Œ ì„œë²„ëŠ” Access-Control-Allow-Origin í—¤ë” 
"*" ì™€ì¼ë“œì¹´ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ ì— ë°˜ë“œì‹œ ì— ê°’ì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

ìœ„ ì˜ˆì œì˜ ìš”ì²­ í—¤ë”ì— Cookie í—¤ë”ê°€ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— Access-Control-Allow-Origin
í—¤ë”ì˜ ê°’ì´ "*"ì¸ ê²½ìš° ìš”ì²­ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤. ìœ„ ìš”ì²­ì€ Access-Control-Allow-Origin 
í—¤ë”ê°€ "*" ì™€ì¼ë“œ ì¹´ë“œê°€ ì•„ë‹ˆë¼ "http://foo.example" ë³¸ë˜ ì£¼ì†Œì´ê¸° ë•Œë¬¸ì— 
ìê²©ì¦ëª… ì¸ì‹ ì»¨í…ì¸ ëŠ” ì›¹ í˜¸ì¶œ ì»¨í…ì¸ ë¡œ ë¦¬í„´ë©ë‹ˆë‹¤.
```
